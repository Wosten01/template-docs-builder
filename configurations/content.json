[
  {
    "group": "Основные",
    "blocks": [
      {
        "title": "Подключение к серверу",
        "description": "Подключение к VPS по SSH. После ввода команды потребуется ввести пароль пользователя (пароль не отображается).",
        "code": "ssh {root}@{serverIp}"
      },
      {
        "title": "Обновление системы",
        "description": "Обновляет список пакетов и устанавливает последние доступные обновления.",
        "code": "sudo apt update && sudo apt upgrade -y"
      },
      {
        "title": "Создание нового пользователя и добавление в sudo",
        "description": "Создаёт нового пользователя и даёт ему права администратора (через группу sudo). При создании потребуется придумать пароль и при желании заполнить дополнительные данные (они необязательны и могут быть пропущены нажатием Enter).",
        "code": "adduser {username} && usermod -aG sudo {username}"
      },
      {
        "title": "Переключение на нового пользователя",
        "description": "После создания нового пользователя рекомендуется работать под его именем. Для этого используйте команду ниже и введите пароль нового пользователя.",
        "code": "su - {username}"
      }
    ]
  },
  {
    "group": "SSH ключи",
    "blocks": [
      {
        "title": "Создание SSH-ключа ed25519 с заданным именем и путём",
        "description": "Генерирует SSH-ключ типа ed25519 с возможностью указать комментарий (-C) и путь к файлу (-f). Ключ будет сохранён в указанную папку.",
        "steps": [
          "Откройте терминал.",
          {
            "text": "Вставьте команду, указав свой комментарий (например, имя или email) и путь к нужной папке/файлу.",
            "code": "ssh-keygen -t ed25519 -C \"{ssh_comment}\" -f {ssh_path_to_key}"
          },
          "Нажмите Enter. Если папка не существует, создайте её предварительно: mkdir -p ~/.ssh/vps",
          "При желании введите passphrase для ключа или оставьте пустым."
        ]
      },
      {
        "title": "Копировать SSH-ключ на сервер",
        "description": "Передаёт публичный ключ на сервер для входа без пароля.",
        "steps": [
          "Убедитесь, что сервер доступен по SSH.",
          {
            "text": "Выполните команду:",
            "code": "ssh-copy-id -i {ssh_path_to_pub_key} {username}@{serverIp}"
          },
          "Введите пароль пользователя сервера по запросу.",
          "Теперь для входа будет использоваться ваш SSH-ключ без необходимости каждый раз вводить пароль."
        ]
      },
      {
        "title": "Настройка подключения в ~/.ssh/config",
        "description": "Позволяет создать простую команду alias для подключения к серверу без ввода IP, логина и пути к ключу каждый раз.",
        "steps": [
          {
            "text": "Откройте или создайте файл конфигурации:",
            "code": { "text": "nano ~/.ssh/config", "showArrow": "true" }
          },
          {
            "text": "Добавьте в файл блок (замените значения на свои):",
            "code": {
              "text": "Host {host_name}\n\tHostName {serverIp}\n\tUser {username}\n\tPort {ssh_port}\n\tIdentityFile {ssh_path_to_pub_key}\n\tIdentitiesOnly yes",
              "showArrow": "false"
            }
          },

          "Сохраните файл (Ctrl+O), затем выйдите из редактора (Ctrl+X).",
          {
            "text": "Проверьте права доступа:",
            "code": "chmod 600 ~/.ssh/config"
          },
          {
            "text": "Теперь можно подключаться по имени alias (возможно снова придется ввести код пользователя {username}):",
            "code": "ssh {host_name}"
          }
        ]
      }
    ]
  },
  {
    "group": "Настройка сервера",
    "blocks": [
      {
        "title": "Смена порта SSH, отключение входа по паролю и для root",
        "description": "Улучшает безопасность сервера: настраивает нестандартный порт SSH, запрещает вход по паролю и отключает прямой доступ для пользователя root.",

        "steps": [
          {
            "text": "Откройте файл конфигурации SSH:",
            "code": "sudo nano /etc/ssh/sshd_config"
          },
          {
            "text": "Найдите или добавьте следующие строки и задайте нужные значения:",
            "code": {
              "text": "Port {ssh_port}\nPermitRootLogin no\nPasswordAuthentication no",
              "separateLines": "true"
            }
          },
          "Проверьте, чтобы строки не были закомментированы (без символа # в начале).",
          "Сохраните изменения (Ctrl+O), нажмите Enter и выйдите из редактора (Ctrl+X).",
          {
            "text": "Разрешите новый порт в брандмауэре (если используется UFW):",
            "code": "sudo ufw allow {ssh_port}/tcp && sudo ufw reload"
          },
          {
            "text": "Перезапустите SSH-сервис, чтобы применить обновлённые настройки:",
            "code": "sudo systemctl restart ssh"
          },
          {
            "text": "Теперь подключение нужно выполнять с указанием нового порта:",
            "code": "ssh -p {ssh_port} {username}@{serverIp}"
          }
        ],
        "note": "Не закрывайте активную SSH-сессию, пока не убедитесь, что можно подключиться по новому порту. Убедитесь, что SSH-ключи настроены и пользователь имеет доступ с sudo. Выбранный порт должен быть в диапазоне 1024–65535 и не использоваться другими службами."
      }
    ]
  }
]
